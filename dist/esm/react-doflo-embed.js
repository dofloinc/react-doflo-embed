import e,{useRef as n,useState as r,useEffect as t,useCallback as o}from"react";function i(i){var a=n(null),c=n([]),s=r(!1),l=s[0],d=s[1],w=r(i.src),u=w[0],f=w[1],m=r(!1),p=m[0],g=m[1],h=r("300px"),v=h[0],E=h[1],x=r(.01),y=x[0],b=x[1];t((function(){a.current&&c.current.length>0&&(c.current.forEach((function(e){I(e)})),c.current=[])}),[a.current]);var I=o((function(e){if(e.data.split){var n=e.data.split(":"),r=n[2];if(a.current){if(a.current.src.split("?")[0].indexOf(r)>-1){switch(n[0]){case"scrollIntoView":a.current.scrollIntoView();break;case"setHeight":E("".concat(n[1],"px")),b(1);break;case"collapseErrorPage":a.current.clientHeight>window.innerHeight&&E("".concat(n[1],"px"));break;case"reloadPage":window.location.reload()}if(e.origin.indexOf("doflo")>-1&&a.current&&"contentWindow"in a.current&&"postMessage"in a.current.contentWindow){var t={docurl:encodeURIComponent(window.document.URL),referrer:encodeURIComponent(window.document.referrer)};a.current.contentWindow.postMessage(JSON.stringify({type:"urls",value:t}),"*")}}}else c.current.push(e)}}),[]);return t((function(){if(a.current&&!p){g(!0);var e=u,n=[];if(window.location.href&&window.location.href.indexOf("?")>-1&&(n=n.concat(window.location.href.split("?")[1].split("&"))),e&&e.indexOf("?")>-1){var r=e.split("?");n=n.concat(r[1].split("&")),e=r[0]}n.push("isIframeEmbed=1"),f(e+"?"+n.join("&"))}return window.addEventListener&&!l?(d(!0),window.addEventListener("message",I,!1)):window.attachEvent&&!l&&(d(!0),window.attachEvent("onmessage",I)),function(){window.removeEventListener&&l?(d(!1),window.removeEventListener("message",I,!1)):window.detachEvent&&l&&(d(!1),window.detachEvent("onmessage",I))}})),e.createElement("iframe",{ref:a,style:{height:v,transition:"opacity 0.3s linear",width:"100%",opacity:y},className:i.className,allow:"geolocation; microphone; camera",sandbox:"allow-same-origin allow-scripts allow-modals allow-forms",src:u,frameBorder:0,scrolling:i.scrolling?"yes":"no"})}export{i as default};
//# sourceMappingURL=react-doflo-embed.js.map
